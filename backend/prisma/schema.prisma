generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {  
  id              Int            @id @default(autoincrement())  
  name            String  
  email           String         @unique  
  password        String
  phone_number    String?
  role            Role
  refreshTokens RefreshToken?
  appointments    Appointment[]  @relation("ClientAppointments") 
}

model RefreshToken {
  id        Int      @id @default(autoincrement())
  token     String
  createdAt DateTime @default(now())
  expiresAt DateTime
  user      User     @relation(fields: [userId], references: [id])
  userId    Int      @unique
}

enum Role {
  ADMIN
  CUSTOMER
}

model Service {
  id                Int      @id @default(autoincrement())
  name              String   @unique
  description       String?
  disabled          Boolean  @default(false)
  appointments Appointment[]
}


enum SessionType {
  MIN_40
  MIN_60
  MIN_90
  PREMIUM_60
  DOMICILIO_60
  PACK_3x40
}

model Availability {
  id          Int      @id @default(autoincrement())
  week_day    WeekDay
  start_time  DateTime
  end_time    DateTime

  @@unique([week_day])
}

enum WeekDay {
  MONDAY
  TUESDAY
  WEDNESDAY
  THURSDAY
  FRIDAY
  SATURDAY
  SUNDAY
}

model Appointment {
  id                Int                  @id @default(autoincrement())
  appointment_date  DateTime
  start_time        DateTime
  end_time          DateTime
  session_type      SessionType
  state             AppointmentState     @default(PENDING) 

  client            User     @relation("ClientAppointments", fields: [clientId], references: [id])
  clientId          Int
  
  service           Service @relation(fields: [serviceId], references: [id])
  serviceId         Int

  @@unique([appointment_date, start_time, clientId])
} 

enum AppointmentState {
  PENDING
  CONFIRMED
  CANCELED
  COMPLETED
  NOT_ASSISTED
}